---
layout: base
---

{% assign newest_post = site.posts.first %}
{% assign total_miles = 0 %}

{% for post in site.posts %}
  {% assign total_miles = total_miles | plus: post.miles %}
{% endfor %}

{% capture header_line1 %}
    Blake is {{ newest_post.home_title }}
{% endcapture %}

{% capture header_line2 %}
    He's traveled {{ total_miles | floor }} miles so far
{% endcapture %}

{% if newest_post.banner %}
    {% include header_banner.html banner=newest_post.banner banner_font=newest_post.banner_font line1=header_line1 line2=header_line2 %}
{% else %}
    {% include header_plain.html line1=header_line1 line2=header_line2 %}
{% endif %}

<div id="map"></div>

<div class="container">
    <div class="home-feed">
        <h2 class="mt-5 mb-5">Updates</h2>
    
        {% for post in site.posts %}
            <div class="card mb-4">
                <h3 class="card-title"><a href="{{ post.url}}">{{ post.title }}</a></h3>
                <h6 class="card-subtitle text-muted">
                    {{ post.date | date: "%A, %B %e, %Y" }}
                </h4>
                <span class="badge badge-pill badge-light" id="count-{{ post.id | slugify }}">
                    {{ post.photos }} 
                    {% if post.photos == 1 %}
                        photo
                    {% else %}
                        photos
                    {% endif %}
                </span>
            </div>
        {% endfor %}
    </div>
</div>

<script src="/assets/js/mapstyles.js"></script>
<script src="/assets/js/travelmap.js"></script>
<script src="/assets/js/post-view-tracker.js"></script>
<script>
    var newestPostId = '{{ newest_post.id }}';
    var newestPostPhotoCount = {{ newest_post.photos }};
    var locations = [
        {% for post in site.posts %}
            { 
                url: "{{ post.url }}",
                coords: { lat: {{ post.lat }}, lng: {{ post.lng }} } 
            },
        {% endfor %}
    ];

    var travelMap = new TravelMap(locations);
    var postViewTracker = new PostViewTracker(newestPostId, newestPostPhotoCount);

    if(!postViewTracker.hasSeenAllLatestPostPhotos()) {
        var badge = document.getElementById('count-{{ newest_post.id | slugify }}')
        badge.classList.remove('badge-light');
        badge.classList.add('badge-success');
    }
</script>
<script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDmAAJe34ANGnmTzf--hAkQsqmRpxEwDJc&callback=travelMap.init" type="text/javascript"></script>